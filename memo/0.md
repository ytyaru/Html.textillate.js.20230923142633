# テキスト・アニメーション

[textillate.js]:https://github.com/jschr/textillate
[jquery]:https://jquery.com/
[animate.css]:https://animate.style/

　[textillate.js][]を使ってテキストアニメーションする。Zoom系アニメがなかった。実装は[jquery][]と[animate.css][]に依存している。

[cssanimation.io]:https://cssanimation.io/

　[cssanimation.io][]はZoom系アニメがあった。

# 台本（原稿）

## シンプル

1.txt
```
一度の窓に表示するテキストを
１つの改行以内で書く。
この単位をブロックと呼ぶ。

ブロックの末尾まで表示したら入力待ちになる。
クリックやタップなどの入力がされるまで表示されない。

一度の窓内テキストで２行以上の改行を入れたければ
\n
\\nだけの行を入れること。\\nは複数連続してもよい。\\n行が連続してもよい。

一度の窓内で入力待ちさせたければ{tap}
\{tap}を入力すること。

一定時間待機したければ{3000}
\{半角数字でミリ秒時間}を入力すること。

? あなたは人間ですか？
はい	え、人間なのですか。知りませんでした。
いいえ	なら何なのでしょうか。いえ、興味ありません。

? あなたはなぜ生きているのですか？
はい
いいえ

# はい

とくに理由はないと。
そうですか。

# いいえ

すでに死んでいる、と。
でしょうね。

# 

以上で終了です。

> 2.txt
```

```html
<script="this-lib.js"></script>
<div id="message-window" data-file="1.txt"></div>
```
```javascript
```

### 質問構文

#### ネスト

```
? あなたはなぜ生きているのですか？
はい
いいえ

# はい

とくに理由はないと。
そうですか。

? なぜ死なないのですか？
はい
いいえ

# はい

やはり特に理由はないと。そうですか。

# いいえ

え、死んで……それは失礼しました。

# 

# いいえ

すでに死んでいる、と。
でしょうね。

# 

以上で終了です。

```

　子の分岐はタブでネストしたほうが見やすい。

```
? あなたはなぜ生きているのですか？
はい
いいえ

# はい

とくに理由はないと。
そうですか。

? なぜ死なないのですか？
はい
いいえ

	# はい

	やはり特に理由はないと。そうですか。

	# いいえ

	え、死んで……それは失礼しました。

	# 

# いいえ

すでに死んでいる、と。
でしょうね。

# 

以上で終了です。

```

#### 省略形

##### 回答が１ブロック分のみ

```
? あなたは人間ですか？
はい	え、人間なのですか。知りませんでした。
いいえ	なら何なのでしょうか。いえ、興味ありません。
```

##### 回答が他ファイルに定義されている

```
? あなたは人間ですか？
はい	> 1-A.txt
いいえ	> 1-B.txt
```

##### 回答の最後がすべて共通＆他ファイル定義

```
? あなたは人間ですか？
はい	> 1-A.txt
いいえ	> 1-B.txt
		> 1-Z.txt
```

## 複雑

### ルビ

```
漢字《かんじ》にルビを振る。
```
```
<ruby>漢字<rp>（</rp><rt>かんじ</rt><rp>）</rp></ruby>
```

　１字ずつアニメさせるのが難しい。アニメは１文字ずつ追加していくか、１文字ずつタグで囲むのが定石。だがタグに囲まれているテキストの場合、そのまま１字ずつ追加するとタグも含まれたり、壊れたタグになってしまう。たとえば以下のようになってしまう。タグは表示したくない。

```
<
<r
<ru
<rub
```

　そこでタグは表示文字にはせずHTMLタグとして解読するように作り込む。それ自体が面倒きわまりないが、仮にそれができたとしても、どのタグの、どの位置に、どの字を入れるかも、面倒きわまりない処理がいる。たとえば以下のように、親字を<ruby>の直後に、ルビを`<rt>`の直後に、それぞれ追加していく。単純に+1とはいかない。

```
<ruby></ruby>
<ruby>漢</ruby>
<ruby>漢字</ruby>
<ruby>漢字<rp>（</rp><rt>か</rt><rp>）</rp></ruby>
<ruby>漢字<rp>（</rp><rt>かん</rt><rp>）</rp></ruby>
<ruby>漢字<rp>（</rp><rt>かんじ</rt><rp>）</rp></ruby>
<ruby></ruby>
```

　さらに親字とルビの対応が不可能。この場合"漢"を表示したときルビは"かん"となることが期待される。

```
<ruby>漢<rp>（</rp><rt>かん</rt><rp>）</rp></ruby>
```

　だが、これを実現するには次のような原稿を書かねばならない。

```
漢《かん》字《じ》
```
```
<ruby>漢<rp>（</rp><rt>かん</rt><rp>）</rp>字<rp>（</rp><rt>じ</rt><rp>）</rp></ruby>
```

　面倒すぎる。しかもルビ非対応だと次のようなテキストで表示されてしまう。ウザい。`漢字（かんじ）`にしてほしい。

```
漢（かん）字（じ）
```

　原稿の簡便さと、ルビ表示の正確さが、両立できない。

　しかたなく次のような妥協案を探る。どれも一長一短。

* 親字とルビの比（上記例なら親1字あたりルビ1.5字を同時表示する。漢字との対応が不正確になる）
* 親字をすべて出したあとルビを出す
	* ルビは１字ずつ（冗長。ルビのほうが長いのに表示までの待機時間がムダに長くなる。漢字と一緒に出せと思う）
	* ルビは一括で出す（雑。ルビのほうが長いのに一気に出される。ならもっと早く出してくれと思う）

　実装が大変で、原稿も面倒になり、アニメの品質（漢字とルビの対応の正確さ）が低い。

　はたしてこれは実装する価値があるだろうか。優先度は下げざるを得ない。

　ただし１字アニメでなく一括アニメならばルビが欲しいときもある。悩ましい。

### 変数、関数

```
:fps 15
:cols 35 :rows 5
:align center
:名前 山田太郎
:年齢 20
:御年 {年齢}

{名前}という名前で、{年齢}歳です。

{年齢 += 1}
{年齢 += 年齢}

{関数名 {名前}}
{Math.abs {年齢}}
```

　グローバル変数やユーザ変数を定義できる。書式は`:変数名 値`。

　変数の参照は`{変数名}`である。

　関数の実行は`{関数名 引数 引数 ...}`

* もし値に半角スペースを入れたいなら
	* `'  値  '`のようにシングルクォートで囲む
	* `"  値  "`のようにダブルクォートで囲む
	* `` `  値  ` ``のようにバッククォートで囲む
	* メタ文字の区切りを半角スペースでなくタブにする
	* （変数の値に含まれているときは自動的に塊として扱われる）

### リンク

* `<a>`（リンク）
* `<audio>`,`<img>`,`<video>`

　外部コンテンツにアクセスできること。`<a>`ができれば宣伝や寄付など一気に広がる。

### インタラクティブ

* テキスト入力
* 数値（範囲）、日付、色、ファイル入力
* コンボボックス／リスト／チェック（ラジオ）

　ユーザからの入力受付。選択肢に加えて名前を入力できれば介入できた感があって嬉しい。

### SEO

　PIXI.TextだとHTML要素として台本テキストが書かれずググラビリティが低い。

　[textillate.js][]、[cssanimation.io][]だと、HTML要素として台本テキストが書かれる。ググラビリティが高く、テキストをコピーすることも可能。クリック→範囲選択→Google検索というのはよくやるが、これも可能。もし小説風にするなら、知らない語が出てきやすく、これをやりたくなるはず。ただ、クリックすると進行するので、難しいかもしれない。

